<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="author" content="Anton Sukhachev">
    <title>Comparing PHP FPM, PHP PPM, Nginx Unit, ReactPHP, and RoadRunner</title>
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>

    <meta name="description" content="Testing was conducted using Yandex Tank. Symfony 4 and PHP 7.2 were used as the application. The goa..."/>
    <meta name="keywords" content="tutorial, development, php-fpm, php-ppm, nginx, nginx-unit, react-php, road runner"/>

    <meta property="og:type" content="website">
    <meta property="og:site_name" content="mrsuh.com">
    <meta property="og:url" content="https://mrsuh.com/articles/2019/comparing-php-fpm-php-ppm-nginx-unit-react-php-and-road-runner/">
    <meta property="og:title" content="Comparing PHP FPM, PHP PPM, Nginx Unit, ReactPHP, and RoadRunner">
    <meta property="og:description" content="Testing was conducted using Yandex Tank. Symfony 4 and PHP 7.2 were used as the application. The goa...">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:alt" content="Anton Sukhachev">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="mrsuh.com">
    <meta name="twitter:url" content="https://mrsuh.com/articles/2019/comparing-php-fpm-php-ppm-nginx-unit-react-php-and-road-runner/">
    <meta name="twitter:title" content="Comparing PHP FPM, PHP PPM, Nginx Unit, ReactPHP, and RoadRunner">
    <meta name="twitter:creator" content="@mrsuh6">
    <meta name="twitter:description" content="Testing was conducted using Yandex Tank. Symfony 4 and PHP 7.2 were used as the application. The goa...">
    <meta name="twitter:image:alt" content="Anton Sukhachev">
    
    <link href="/bootstrap.min.css" rel="stylesheet">
    <link href="/style.css?v=1" rel="stylesheet">
</head>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-GMXWT1YP3F"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-GMXWT1YP3F');
</script>

<body class="container fs-5" style="max-width: 1000px">

<div class="header" style="padding-top: 20px; padding-bottom: 10px">
    <div class="row">
        <div class="col">
            <a href="/">Anton Sukhachev</a>
        </div>
        <div class="col text-end">
            <a href="/articles/">Articles</a>
        </div>
    </div>
    <hr/>
</div>

<div class="content">
    <h1>Comparing PHP FPM, PHP PPM, Nginx Unit, React PHP, and RoadRunner</h1>
<p>Testing was conducted using Yandex Tank.<br />
Symfony 4 and PHP 7.2 were used as the application.<br />
The goal was to compare the performance of the services under different loads and identify the optimal solution.<br />
For convenience, everything was packaged into Docker containers and launched with docker-compose.<br />
The source code is available <a href="https://github.com/mrsuh/php-load-test" target="_blank">here</a>.<br />
All command examples mentioned in the article should be run from the project directory.</p>
<a href="#h2-application" id="h2-application" class="text-decoration-none text-reset"><h2>Application</h2></a>
<p>The application runs on Symfony 4 and PHP 7.2.<br />
It responds to only one route and returns:</p>
<ul>
<li>random number;</li>
<li>environment;</li>
<li>process pid;</li>
<li>application name;</li>
<li>php.ini variables.</li>
</ul>
<p>Response example:</p>
<pre><code class="language-bash rounded">curl 'http://127.0.0.1:8000/' | python -m json.tool
{
    "env": "prod",
    "type": "php-fpm",
    "pid": 8,
    "random_num": 37264,
    "php": {
        "version": "7.2.12",
        "date.timezone": "Europe/Paris",
        "display_errors": "",
        "error_log": "/proc/self/fd/2",
        "error_reporting": "32767",
        "log_errors": "1",
        "memory_limit": "256M",
        "opcache.enable": "1",
        "opcache.max_accelerated_files": "20000",
        "opcache.memory_consumption": "256",
        "opcache.validate_timestamps": "0",
        "realpath_cache_size": "4096K",
        "realpath_cache_ttl": "600",
        "short_open_tag": ""
    }
}</code></pre>
<p>Each container is configured with PHP:</p>
<ul>
<li>OPcache enabled;</li>
<li>bootstrap cache configured using Composer;</li>
<li>php.ini settings aligned with <a href="https://symfony.com/doc/current/performance.html#performance-install-apcu-polyfill" target="_blank">Symfony's best practices</a>.</li>
</ul>
<p>Logs are written to stderr:<br />
/config/packages/prod/monolog.yaml</p>
<pre><code class="language-yaml rounded">monolog:
    handlers:
        main:
            type: stream
            path: "php://stderr"
            level: error
        console:
            type: console</code></pre>
<p>The cache is stored in /dev/shm:<br />
/src/Kernel.php</p>
<pre><code class="language-php rounded">...
class Kernel extends BaseKernel
{
    public function getCacheDir()
    {
        if ($this-&gt;environment === 'prod') {
            return '/dev/shm/symfony-app/cache/' . $this-&gt;environment;
        } else {
            return $this-&gt;getProjectDir() . '/var/cache/' . $this-&gt;environment;
        }
    }
}
...</code></pre>
<p>Each docker-compose setup includes three main containers:</p>
<ul>
<li>nginx - reverse proxy server;</li>
<li>app - the prepared application code with all dependencies;</li>
<li>PHP FPM / Nginx Unit / RoadRunner / ReactPHP - the application server.</li>
</ul>
<p>Request handling is limited to two application instances (equal to the number of CPU cores).</p>
<a href="#h2-services" id="h2-services" class="text-decoration-none text-reset"><h2>Services</h2></a>
<a href="#h3-php-fpm" id="h3-php-fpm" class="text-decoration-none text-reset"><h3>PHP FPM</h3></a>
<p><a href="http://php.net/manual/ru/install.fpm.php" target="_blank">PHP Process Manager</a>. Written in C.</p>
<p>Pros:</p>
<ul>
<li>no need to monitor memory usage.</li>
<li>no changes required in the application.</li>
</ul>
<p>Cons:</p>
<ul>
<li>PHP initializes variables for every request.</li>
</ul>
<p>Command to run the application with docker-compose:</p>
<pre><code class="language-bash rounded">cd docker/php-fpm &amp;&amp; docker-compose up -d</code></pre>
<a href="#h3-php-ppm" id="h3-php-ppm" class="text-decoration-none text-reset"><h3>PHP PPM</h3></a>
<p><a href="https://github.com/php-pm/php-pm" target="_blank">PHP Process Manager</a>. Written in PHP.</p>
<p>Pros:</p>
<ul>
<li>initializes variables once and reuses them afterward.</li>
<li>no changes required in the application (ready-made modules available for Symfony, Laravel, Zend, and CakePHP).</li>
</ul>
<p>Cons:</p>
<ul>
<li>requires memory management.</li>
</ul>
<p>Command to run the application with docker-compose:</p>
<pre><code class="language-bash rounded">cd docker/php-ppm &amp;&amp; docker-compose up -d</code></pre>
<a href="#h3-nginx-unit" id="h3-nginx-unit" class="text-decoration-none text-reset"><h3>Nginx Unit</h3></a>
<p><a href="(https://unit.nginx.org)" target="_blank">Application Server by the Nginx Team</a>. Written in C</p>
<p>Pros:</p>
<ul>
<li>configuration can be modified via HTTP API.</li>
<li>allows running multiple instances of the same application with different configurations and language versions simultaneously.</li>
<li>no need to manage memory.</li>
<li>no changes required in the application.</li>
</ul>
<p>Cons:</p>
<ul>
<li>PHP initializes variables for each request.</li>
</ul>
<p>To pass environment variables from the Nginx Unit configuration file, you need to adjust the php.ini:</p>
<pre><code class="language-ini rounded">; Nginx Unit
variables_order=E</code></pre>
<p>Command to run the application with docker-compose:</p>
<pre><code class="language-bash rounded">cd docker/nginx-unit &amp;&amp; docker-compose up -d</code></pre>
<a href="#h3-react-php" id="h3-react-php" class="text-decoration-none text-reset"><h3>React PHP</h3></a>
<p><a href="https://reactphp.org" target="_blank">Event-Driven Programming Library</a>. Written in PHP.</p>
<p>Pros:</p>
<ul>
<li>the library allows you to write a server that initializes variables only once and then continues to reuse them.</li>
</ul>
<p>Cons:</p>
<ul>
<li>requires custom server implementation.</li>
<li>memory management is necessary.</li>
</ul>
<p>If you use the <code>--reboot-kernel-after-request</code> flag for the worker, the Symfony Kernel will reinitialize for each request. With this approach, memory management is no longer required.</p>
<pre><code class="language-php rounded">#!/usr/bin/env php

&lt;?php

use App\Kernel;
use Symfony\Component\Debug\Debug;
use Symfony\Component\HttpFoundation\Request;

require __DIR__ . '/../config/bootstrap.php';

$env   = $_SERVER['APP_ENV'] ?? $_ENV['APP_ENV'] ?? 'dev';
$debug = (bool)($_SERVER['APP_DEBUG'] ?? $_ENV['APP_DEBUG'] ?? ('prod' !== $env));

if ($debug) {
    umask(0000);

    Debug::enable();
}

if ($trustedProxies = $_SERVER['TRUSTED_PROXIES'] ?? $_ENV['TRUSTED_PROXIES'] ?? false) {
    Request::setTrustedProxies(explode(',', $trustedProxies), Request::HEADER_X_FORWARDED_ALL ^ Request::HEADER_X_FORWARDED_HOST);
}

if ($trustedHosts = $_SERVER['TRUSTED_HOSTS'] ?? $_ENV['TRUSTED_HOSTS'] ?? false) {
    Request::setTrustedHosts(explode(',', $trustedHosts));
}

$loop   = React\EventLoop\Factory::create();
$kernel = new Kernel($env, $debug);
$kernel-&gt;boot();
$rebootKernelAfterRequest = in_array('--reboot-kernel-after-request', $argv);

/** @var \Psr\Log\LoggerInterface $logger */
$logger = $kernel-&gt;getContainer()-&gt;get('logger');
$server = new React\Http\Server(function (Psr\Http\Message\ServerRequestInterface $request) use ($kernel, $logger, $rebootKernelAfterRequest) {

    $method  = $request-&gt;getMethod();
    $headers = $request-&gt;getHeaders();
    $content = $request-&gt;getBody();
    $post    = [];
    if (in_array(strtoupper($method), ['POST', 'PUT', 'DELETE', 'PATCH']) &amp;&amp;
        isset($headers['Content-Type']) &amp;&amp; (0 === strpos($headers['Content-Type'], 'application/x-www-form-urlencoded'))
    ) {
        parse_str($content, $post);
    }
    $sfRequest = new Symfony\Component\HttpFoundation\Request(
        $request-&gt;getQueryParams(),
        $post,
        [],
        $request-&gt;getCookieParams(),
        $request-&gt;getUploadedFiles(),
        [],
        $content
    );
    $sfRequest-&gt;setMethod($method);
    $sfRequest-&gt;headers-&gt;replace($headers);
    $sfRequest-&gt;server-&gt;set('REQUEST_URI', $request-&gt;getUri());

    if (isset($headers['Host'])) {
        $sfRequest-&gt;server-&gt;set('SERVER_NAME', current($headers['Host']));
    }

    try {
        $sfResponse = $kernel-&gt;handle($sfRequest);
    } catch (\Exception $e) {
        $logger-&gt;error('Internal server error', ['error' =&gt; $e-&gt;getMessage(), 'trace' =&gt; $e-&gt;getTraceAsString()]);
        $sfResponse = new \Symfony\Component\HttpFoundation\Response('Internal server error', 500);
    } catch (\Throwable $e) {
        $logger-&gt;error('Internal server error', ['error' =&gt; $e-&gt;getMessage(), 'trace' =&gt; $e-&gt;getTraceAsString()]);
        $sfResponse = new \Symfony\Component\HttpFoundation\Response('Internal server error', 500);
    }

    $kernel-&gt;terminate($sfRequest, $sfResponse);
    if ($rebootKernelAfterRequest) {
        $kernel-&gt;reboot(null);
    }

    return new React\Http\Response(
        $sfResponse-&gt;getStatusCode(),
        $sfResponse-&gt;headers-&gt;all(),
        $sfResponse-&gt;getContent()
    );
});

$server-&gt;on('error', function (\Exception $e) use ($logger) {
    $logger-&gt;error('Internal server error', ['error' =&gt; $e-&gt;getMessage(), 'trace' =&gt; $e-&gt;getTraceAsString()]);
});

$socket = new React\Socket\Server('tcp://0.0.0.0:9000', $loop);
$server-&gt;listen($socket);

$logger-&gt;info('Server running', ['addr' =&gt; 'tcp://0.0.0.0:9000']);

$loop-&gt;run();</code></pre>
<p>Command to run the application with docker-compose:</p>
<pre><code class="language-bash rounded">cd docker/react-php &amp;&amp; docker-compose up -d --scale php=2</code></pre>
<a href="#h3-road-runner" id="h3-road-runner" class="text-decoration-none text-reset"><h3>Road Runner</h3></a>
<p><a href="https://github.com/spiral/roadrunner/wiki/About-RoadRunner" target="_blank">Web Server and PHP Process Manager</a>. Written in Go</p>
<p>Pros:</p>
<ul>
<li>you can write a worker that initializes variables only once and continues to reuse them.</li>
</ul>
<p>Cons:</p>
<ul>
<li>
<p>custom worker implementation is required.</p>
</li>
<li>
<p>memory management is necessary.</p>
</li>
<li>
<p>If the <code>--reboot-kernel-after-request</code> flag is used for the worker, the Symfony Kernel will reinitialize for every request. This eliminates the need for memory management.</p>
</li>
</ul>
<pre><code class="language-php rounded">#!/usr/bin/env php

&lt;?php

use App\Kernel;
use Spiral\Goridge\SocketRelay;
use Spiral\RoadRunner\PSR7Client;
use Spiral\RoadRunner\Worker;
use Symfony\Bridge\PsrHttpMessage\Factory\DiactorosFactory;
use Symfony\Bridge\PsrHttpMessage\Factory\HttpFoundationFactory;
use Symfony\Component\Debug\Debug;
use Symfony\Component\HttpFoundation\Request;

require __DIR__ . '/../config/bootstrap.php';

$env   = $_SERVER['APP_ENV'] ?? $_ENV['APP_ENV'] ?? 'dev';
$debug = (bool)($_SERVER['APP_DEBUG'] ?? $_ENV['APP_DEBUG'] ?? ('prod' !== $env));

if ($debug) {
    umask(0000);

    Debug::enable();
}

if ($trustedProxies = $_SERVER['TRUSTED_PROXIES'] ?? $_ENV['TRUSTED_PROXIES'] ?? false) {
    Request::setTrustedProxies(explode(',', $trustedProxies), Request::HEADER_X_FORWARDED_ALL ^ Request::HEADER_X_FORWARDED_HOST);
}

if ($trustedHosts = $_SERVER['TRUSTED_HOSTS'] ?? $_ENV['TRUSTED_HOSTS'] ?? false) {
    Request::setTrustedHosts(explode(',', $trustedHosts));
}

$kernel = new Kernel($env, $debug);
$kernel-&gt;boot();
$rebootKernelAfterRequest = in_array('--reboot-kernel-after-request', $argv);
$relay                    = new SocketRelay('/tmp/road-runner.sock', null, SocketRelay::SOCK_UNIX);
$psr7                     = new PSR7Client(new Worker($relay));
$httpFoundationFactory    = new HttpFoundationFactory();
$diactorosFactory         = new DiactorosFactory();

while ($req = $psr7-&gt;acceptRequest()) {
    try {
        $request  = $httpFoundationFactory-&gt;createRequest($req);
        $response = $kernel-&gt;handle($request);
        $psr7-&gt;respond($diactorosFactory-&gt;createResponse($response));
        $kernel-&gt;terminate($request, $response);
        if($rebootKernelAfterRequest) {
            $kernel-&gt;reboot(null);
        }
    } catch (\Throwable $e) {
        $psr7-&gt;getWorker()-&gt;error((string)$e);
    }
}</code></pre>
<p>Command to run the application with docker-compose:</p>
<pre><code class="language-bash rounded">cd docker/road-runner &amp;&amp; docker-compose up -d</code></pre>
<a href="#h2-testing" id="h2-testing" class="text-decoration-none text-reset"><h2>Testing</h2></a>
<p>The testing was conducted using Yandex Tank. The application and Yandex Tank were on different virtual servers.</p>
<p>Specifications of the virtual server with the application:<br />
<strong>Virtualization</strong>: KVM<br />
<strong>CPU</strong>: 2 cores<br />
<strong>RAM</strong>: 4096 MB<br />
<strong>SSD</strong>: 50 GB<br />
<strong>Connection</strong>: 100MBit<br />
<strong>OS</strong>: CentOS 7 (64x)</p>
<p>Services:</p>
<ul>
<li>php-fpm</li>
<li>php-ppm</li>
<li>nginx-unit</li>
<li>road-runner</li>
<li>road-runner-reboot (with <code>--reboot-kernel-after-request</code> flag)</li>
<li>react-php</li>
<li>react-php-reboot (with <code>--reboot-kernel-after-request</code> flag)</li>
</ul>
<p>For the 1000/10000 rps tests, the php-fpm-80 service was added.<br />
The php-fpm configuration used for it was:</p>
<pre><code class="language-ini rounded">pm = dynamic
pm.max_children = 80</code></pre>
<p>Yandex Tank decides beforehand how many times it needs to hit the target and doesn't stop until it runs out of &quot;ammo.&quot; Depending on how quickly the service responds, the test may take longer than the time specified in the configuration. As a result, the graphs for different services may have different lengths. The slower the service responds, the longer its graph will be.<br />
For each service and configuration, Yandex Tank ran only one test. So, the numbers may not be exact. The goal was to compare the performance of the services against each other.</p>
<a href="#h2-100-rps" id="h2-100-rps" class="text-decoration-none text-reset"><h2>100 rps</h2></a>
<a href="#h3-phantom-yandex-tank-configuration" id="h3-phantom-yandex-tank-configuration" class="text-decoration-none text-reset"><h3>Phantom Yandex Tank configuration</h3></a>
<pre><code class="language-yaml rounded">phantom:
    load_profile:
        load_type: rps
        schedule: line(1, 100, 60s) const(100, 540s)</code></pre>
<a href="#h3-here-are-the-links-to-the-detailed-report" id="h3-here-are-the-links-to-the-detailed-report" class="text-decoration-none text-reset"><h3>Here are the links to the detailed report</h3></a>
<ul>
<li>php-fpm <a href="https://overload.yandex.net/150666">https://overload.yandex.net/150666</a></li>
<li>php-ppm <a href="https://overload.yandex.net/150670">https://overload.yandex.net/150670</a></li>
<li>nginx-unit <a href="https://overload.yandex.net/150675">https://overload.yandex.net/150675</a></li>
<li>road-runner <a href="https://overload.yandex.net/150681">https://overload.yandex.net/150681</a></li>
<li>road-runner-reboot <a href="https://overload.yandex.net/151961">https://overload.yandex.net/151961</a></li>
<li>react-php <a href="https://overload.yandex.net/150697">https://overload.yandex.net/150697</a></li>
<li>react-php-reboot <a href="https://overload.yandex.net/152063">https://overload.yandex.net/152063</a></li>
</ul>
<a href="#h3-response-time-percentiles" id="h3-response-time-percentiles" class="text-decoration-none text-reset"><h3>Response Time Percentiles</h3></a>
<table class="table table-bordered">
<thead class="table-secondary">
<tr>
<th></th>
<th>95%(ms)</th>
<th>90%(ms)</th>
<th>80%(ms)</th>
<th>50%(ms)</th>
<th>HTTP OK(%)</th>
<th>HTTP OK(count)</th>
</tr>
</thead>
<tbody>
<tr>
<td>php-fpm</td>
<td>9.9</td>
<td>6.3</td>
<td>4.35</td>
<td>3.59</td>
<td>100</td>
<td>57030</td>
</tr>
<tr>
<td>php-ppm</td>
<td>9.4</td>
<td>6</td>
<td>3.88</td>
<td>3.16</td>
<td>100</td>
<td>57030</td>
</tr>
<tr>
<td>nginx-unit</td>
<td>11</td>
<td>6.6</td>
<td>4.43</td>
<td>3.69</td>
<td>100</td>
<td>57030</td>
</tr>
<tr>
<td>road-runner</td>
<td>8.1</td>
<td>5.1</td>
<td>3.53</td>
<td>2.92</td>
<td>100</td>
<td>57030</td>
</tr>
<tr>
<td>road-runner-reboot</td>
<td>12</td>
<td>8.6</td>
<td>5.3</td>
<td>3.85</td>
<td>100</td>
<td>57030</td>
</tr>
<tr>
<td>react-php</td>
<td>8.5</td>
<td>4.91</td>
<td>3.29</td>
<td>2.74</td>
<td>100</td>
<td>57030</td>
</tr>
<tr>
<td>react-php-reboot</td>
<td>13</td>
<td>8.5</td>
<td>5.5</td>
<td>3.95</td>
<td>100</td>
<td>57030</td>
</tr>
</tbody>
</table>
<a href="#h3-monitoring" id="h3-monitoring" class="text-decoration-none text-reset"><h3>Monitoring</h3></a>
<table class="table table-bordered">
<thead class="table-secondary">
<tr>
<th></th>
<th>cpu median(%)</th>
<th>cpu max(%)</th>
<th>memory median(MB)</th>
<th>memory max(MB)</th>
</tr>
</thead>
<tbody>
<tr>
<td>php-fpm</td>
<td>9.15</td>
<td>12.58</td>
<td>880.32</td>
<td>907.97</td>
</tr>
<tr>
<td>php-ppm</td>
<td>7.08</td>
<td>13.68</td>
<td>901.72</td>
<td>913.80</td>
</tr>
<tr>
<td>nginx-unit</td>
<td>9.56</td>
<td>12.54</td>
<td>923.02</td>
<td>943.90</td>
</tr>
<tr>
<td>road-runner</td>
<td>5.57</td>
<td>8.61</td>
<td>992.71</td>
<td>1,001.46</td>
</tr>
<tr>
<td>road-runner-reboot</td>
<td>9.18</td>
<td>12.67</td>
<td>848.43</td>
<td>870.26</td>
</tr>
<tr>
<td>react-php</td>
<td>4.53</td>
<td>6.58</td>
<td>1,004.68</td>
<td>1,009.91</td>
</tr>
<tr>
<td>react-php-reboot</td>
<td>9.61</td>
<td>12.67</td>
<td>885.92</td>
<td>892.52</td>
</tr>
</tbody>
</table>
<a href="#h3-charts" id="h3-charts" class="text-decoration-none text-reset"><h3>Charts</h3></a>
<p><a href="./images/chart_1_1.png"><img src="./images/chart_1_1.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 1.1 Average Response Time per Second<br />
<a href="./images/chart_1_2.png"><img src="./images/chart_1_2.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 1.2 Average CPU Load per Second<br />
<a href="./images/chart_1_3.png"><img src="./images/chart_1_3.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 1.3 Average Memory Usage per Second</p>
<a href="#h2-500-rps" id="h2-500-rps" class="text-decoration-none text-reset"><h2>500 rps</h2></a>
<a href="#h3-phantom-yandex-tank-configuration" id="h3-phantom-yandex-tank-configuration" class="text-decoration-none text-reset"><h3>Phantom Yandex Tank configuration</h3></a>
<pre><code class="language-yaml rounded">phantom:
    load_profile:
        load_type: rps
        schedule: line(1, 500, 60s) const(500, 540s)</code></pre>
<a href="#h3-here-are-the-links-to-the-detailed-report" id="h3-here-are-the-links-to-the-detailed-report" class="text-decoration-none text-reset"><h3>Here are the links to the detailed report</h3></a>
<ul>
<li>php-fpm <a href="https://overload.yandex.net/150705">https://overload.yandex.net/150705</a></li>
<li>php-ppm <a href="https://overload.yandex.net/150710">https://overload.yandex.net/150710</a></li>
<li>nginx-unit <a href="https://overload.yandex.net/150711">https://overload.yandex.net/150711</a></li>
<li>road-runner <a href="https://overload.yandex.net/150715">https://overload.yandex.net/150715</a></li>
<li>road-runner-reboot <a href="https://overload.yandex.net/152011">https://overload.yandex.net/152011</a></li>
<li>react-php <a href="https://overload.yandex.net/150717">https://overload.yandex.net/150717</a></li>
<li>react-php-reboot <a href="https://overload.yandex.net/152064">https://overload.yandex.net/152064</a></li>
</ul>
<a href="#h3-response-time-percentiles" id="h3-response-time-percentiles" class="text-decoration-none text-reset"><h3>Response Time Percentiles</h3></a>
<table class="table table-bordered">
<thead class="table-secondary">
<tr>
<th></th>
<th>95%(ms)</th>
<th>90%(ms)</th>
<th>80%(ms)</th>
<th>50%(ms)</th>
<th>HTTP OK(%)</th>
<th>HTTP OK(count)</th>
</tr>
</thead>
<tbody>
<tr>
<td>php-fpm</td>
<td>13</td>
<td>8.4</td>
<td>5.3</td>
<td>3.69</td>
<td>100</td>
<td>285030</td>
</tr>
<tr>
<td>php-ppm</td>
<td>15</td>
<td>9</td>
<td>4.72</td>
<td>3.24</td>
<td>100</td>
<td>285030</td>
</tr>
<tr>
<td>nginx-unit</td>
<td>12</td>
<td>8</td>
<td>5.5</td>
<td>3.93</td>
<td>100</td>
<td>285030</td>
</tr>
<tr>
<td>road-runner</td>
<td>9.6</td>
<td>6</td>
<td>3.71</td>
<td>2.83</td>
<td>100</td>
<td>285030</td>
</tr>
<tr>
<td>road-runner-reboot</td>
<td>14</td>
<td>11</td>
<td>7.1</td>
<td>4.45</td>
<td>100</td>
<td>285030</td>
</tr>
<tr>
<td>react-php</td>
<td>9.3</td>
<td>5.8</td>
<td>3.57</td>
<td>2.68</td>
<td>100</td>
<td>285030</td>
</tr>
<tr>
<td>react-php-reboot</td>
<td>15</td>
<td>12</td>
<td>7.2</td>
<td>4.21</td>
<td>100</td>
<td>285030</td>
</tr>
</tbody>
</table>
<a href="#h3-monitoring" id="h3-monitoring" class="text-decoration-none text-reset"><h3>Monitoring</h3></a>
<table class="table table-bordered">
<thead class="table-secondary">
<tr>
<th></th>
<th>cpu median(%)</th>
<th>cpu max(%)</th>
<th>memory median(MB)</th>
<th>memory max(MB)</th>
</tr>
</thead>
<tbody>
<tr>
<td>php-fpm</td>
<td>41.68</td>
<td>48.33</td>
<td>1,006.06</td>
<td>1,015.09</td>
</tr>
<tr>
<td>php-ppm</td>
<td>33.90</td>
<td>48.90</td>
<td>1,046.32</td>
<td>1,055.00</td>
</tr>
<tr>
<td>nginx-unit</td>
<td>42.13</td>
<td>47.92</td>
<td>1,006.67</td>
<td>1,015.73</td>
</tr>
<tr>
<td>road-runner</td>
<td>24.08</td>
<td>28.06</td>
<td>1,035.86</td>
<td>1,044.58</td>
</tr>
<tr>
<td>road-runner-reboot</td>
<td>46.23</td>
<td>52.04</td>
<td>939.63</td>
<td>948.08</td>
</tr>
<tr>
<td>react-php</td>
<td>19.57</td>
<td>23.42</td>
<td>1,049.83</td>
<td>1,060.26</td>
</tr>
<tr>
<td>react-php-reboot</td>
<td>41.30</td>
<td>47.89</td>
<td>957.01</td>
<td>958.56</td>
</tr>
</tbody>
</table>
<a href="#h3-charts" id="h3-charts" class="text-decoration-none text-reset"><h3>Charts</h3></a>
<p><a href="./images/chart_2_1.png"><img src="./images/chart_2_1.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 2.1 Average Response Time per Second<br />
<a href="./images/chart_2_2.png"><img src="./images/chart_2_2.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 2.2 Average CPU Load per Second<br />
<a href="./images/chart_2_3.png"><img src="./images/chart_2_3.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 2.3 Average Memory Usage per Second</p>
<a href="#h2-1000-rps" id="h2-1000-rps" class="text-decoration-none text-reset"><h2>1000 rps</h2></a>
<a href="#h3-phantom-yandex-tank-configuration" id="h3-phantom-yandex-tank-configuration" class="text-decoration-none text-reset"><h3>Phantom Yandex Tank configuration</h3></a>
<pre><code class="language-yaml rounded">phantom:
    load_profile:
        load_type: rps
        schedule: line(1, 1000, 60s) const(1000, 60s)</code></pre>
<a href="#h3-here-are-the-links-to-the-detailed-report" id="h3-here-are-the-links-to-the-detailed-report" class="text-decoration-none text-reset"><h3>Here are the links to the detailed report</h3></a>
<ul>
<li>php-fpm <a href="https://overload.yandex.net/150841">https://overload.yandex.net/150841</a></li>
<li>php-fpm-80 <a href="https://overload.yandex.net/153612">https://overload.yandex.net/153612</a></li>
<li>php-ppm <a href="https://overload.yandex.net/150842">https://overload.yandex.net/150842</a></li>
<li>nginx-unit <a href="https://overload.yandex.net/150843">https://overload.yandex.net/150843</a></li>
<li>road-runner <a href="https://overload.yandex.net/150844">https://overload.yandex.net/150844</a></li>
<li>road-runner-reboot <a href="https://overload.yandex.net/152068">https://overload.yandex.net/152068</a></li>
<li>react-php <a href="https://overload.yandex.net/150846">https://overload.yandex.net/150846</a></li>
<li>react-php-reboot <a href="https://overload.yandex.net/152065">https://overload.yandex.net/152065</a></li>
</ul>
<a href="#h3-response-time-percentiles" id="h3-response-time-percentiles" class="text-decoration-none text-reset"><h3>Response Time Percentiles</h3></a>
<table class="table table-bordered">
<thead class="table-secondary">
<tr>
<th></th>
<th>95%(ms)</th>
<th>90%(ms)</th>
<th>80%(ms)</th>
<th>50%(ms)</th>
<th>HTTP OK(%)</th>
<th>HTTP OK(count)</th>
</tr>
</thead>
<tbody>
<tr>
<td>php-fpm</td>
<td>11050</td>
<td>11050</td>
<td>9040</td>
<td>195</td>
<td>80.67</td>
<td>72627</td>
</tr>
<tr>
<td>php-fpm-80</td>
<td>3150</td>
<td>1375</td>
<td>1165</td>
<td>152</td>
<td>99.85</td>
<td>89895</td>
</tr>
<tr>
<td>php-ppm</td>
<td>2785</td>
<td>2740</td>
<td>2685</td>
<td>2545</td>
<td>100</td>
<td>90030</td>
</tr>
<tr>
<td>nginx-unit</td>
<td>98</td>
<td>80</td>
<td>60</td>
<td>21</td>
<td>100</td>
<td>90030</td>
</tr>
<tr>
<td>road-runner</td>
<td>27</td>
<td>15</td>
<td>7.1</td>
<td>3.21</td>
<td>100</td>
<td>90030</td>
</tr>
<tr>
<td>road-runner-reboot</td>
<td>1110</td>
<td>1100</td>
<td>1085</td>
<td>1060</td>
<td>100</td>
<td>90030</td>
</tr>
<tr>
<td>react-php</td>
<td>23</td>
<td>13</td>
<td>5.6</td>
<td>2.86</td>
<td>100</td>
<td>90030</td>
</tr>
<tr>
<td>react-php-reboot</td>
<td>28</td>
<td>24</td>
<td>19</td>
<td>11</td>
<td>100</td>
<td>90030</td>
</tr>
</tbody>
</table>
<a href="#h3-monitoring" id="h3-monitoring" class="text-decoration-none text-reset"><h3>Monitoring</h3></a>
<table class="table table-bordered">
<thead class="table-secondary">
<tr>
<th></th>
<th>cpu median(%)</th>
<th>cpu max(%)</th>
<th>memory median(MB)</th>
<th>memory max(MB)</th>
</tr>
</thead>
<tbody>
<tr>
<td>php-fpm</td>
<td>12.66</td>
<td>78.25</td>
<td>990.16</td>
<td>1,006.56</td>
</tr>
<tr>
<td>php-fpm-80</td>
<td>83.78</td>
<td>91.28</td>
<td>746.01</td>
<td>937.24</td>
</tr>
<tr>
<td>php-ppm</td>
<td>66.16</td>
<td>91.20</td>
<td>1,088.74</td>
<td>1,102.92</td>
</tr>
<tr>
<td>nginx-unit</td>
<td>78.11</td>
<td>88.77</td>
<td>1,010.15</td>
<td>1,062.01</td>
</tr>
<tr>
<td>road-runner</td>
<td>42.93</td>
<td>54.23</td>
<td>1,010.89</td>
<td>1,068.48</td>
</tr>
<tr>
<td>road-runner-reboot</td>
<td>77.64</td>
<td>85.66</td>
<td>976.44</td>
<td>1,044.05</td>
</tr>
<tr>
<td>react-php</td>
<td>36.39</td>
<td>46.31</td>
<td>1,018.03</td>
<td>1,088.23</td>
</tr>
<tr>
<td>react-php-reboot</td>
<td>72.11</td>
<td>81.81</td>
<td>911.28</td>
<td>961.62</td>
</tr>
</tbody>
</table>
<a href="#h3-charts" id="h3-charts" class="text-decoration-none text-reset"><h3>Charts</h3></a>
<p><a href="./images/chart_3_1.png"><img src="./images/chart_3_1.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 3.1 Average Response Time per Second<br />
<a href="./images/chart_3_2.png"><img src="./images/chart_3_2.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 3.2 Average Response Time per Second (без php-fpm, php-ppm, road-runner-reboot)<br />
<a href="./images/chart_3_3.png"><img src="./images/chart_3_3.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 3.3 Average CPU Load per Second<br />
<a href="./images/chart_3_4.png"><img src="./images/chart_3_4.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 3.4 Average Memory Usage per Second</p>
<a href="#h2-10000-rps" id="h2-10000-rps" class="text-decoration-none text-reset"><h2>10000 rps</h2></a>
<a href="#h3-phantom-yandex-tank-configuration" id="h3-phantom-yandex-tank-configuration" class="text-decoration-none text-reset"><h3>Phantom Yandex Tank configuration</h3></a>
<pre><code class="language-yaml rounded">phantom:
    load_profile:
        load_type: rps
        schedule: line(1, 10000, 30s) const(10000, 30s)</code></pre>
<a href="#h3-here-are-the-links-to-the-detailed-report" id="h3-here-are-the-links-to-the-detailed-report" class="text-decoration-none text-reset"><h3>Here are the links to the detailed report</h3></a>
<ul>
<li>php-fpm <a href="https://overload.yandex.net/150849">https://overload.yandex.net/150849</a></li>
<li>php-fpm-80 <a href="https://overload.yandex.net/153615">https://overload.yandex.net/153615</a></li>
<li>php-ppm <a href="https://overload.yandex.net/150874">https://overload.yandex.net/150874</a></li>
<li>nginx-unit <a href="https://overload.yandex.net/150876">https://overload.yandex.net/150876</a></li>
<li>road-runner <a href="https://overload.yandex.net/150881">https://overload.yandex.net/150881</a></li>
<li>road-runner-reboot <a href="https://overload.yandex.net/152069">https://overload.yandex.net/152069</a></li>
<li>react-php <a href="https://overload.yandex.net/150885">https://overload.yandex.net/150885</a></li>
<li>react-php-reboot <a href="https://overload.yandex.net/152066">https://overload.yandex.net/152066</a></li>
</ul>
<a href="#h3-response-time-percentiles" id="h3-response-time-percentiles" class="text-decoration-none text-reset"><h3>Response Time Percentiles</h3></a>
<table class="table table-bordered">
<thead class="table-secondary">
<tr>
<th></th>
<th>95%(ms)</th>
<th>90%(ms)</th>
<th>80%(ms)</th>
<th>50%(ms)</th>
<th>HTTP OK(%)</th>
<th>HTTP OK(count)</th>
</tr>
</thead>
<tbody>
<tr>
<td>php-fpm</td>
<td>11050</td>
<td>11050</td>
<td>11050</td>
<td>1880</td>
<td>70.466</td>
<td>317107</td>
</tr>
<tr>
<td>php-fpm-80</td>
<td>3260</td>
<td>3140</td>
<td>1360</td>
<td>1145</td>
<td>99.619</td>
<td>448301</td>
</tr>
<tr>
<td>php-ppm</td>
<td>2755</td>
<td>2730</td>
<td>2695</td>
<td>2605</td>
<td>100</td>
<td>450015</td>
</tr>
<tr>
<td>nginx-unit</td>
<td>1020</td>
<td>1010</td>
<td>1000</td>
<td>980</td>
<td>100</td>
<td>450015</td>
</tr>
<tr>
<td>road-runner</td>
<td>640</td>
<td>630</td>
<td>615</td>
<td>580</td>
<td>100</td>
<td>450015</td>
</tr>
<tr>
<td>road-runner-reboot</td>
<td>1130</td>
<td>1120</td>
<td>1110</td>
<td>1085</td>
<td>100</td>
<td>450015</td>
</tr>
<tr>
<td>react-php</td>
<td>1890</td>
<td>1090</td>
<td>1045</td>
<td>58</td>
<td>99.996</td>
<td>449996</td>
</tr>
<tr>
<td>react-php-reboot</td>
<td>3480</td>
<td>3070</td>
<td>1255</td>
<td>91</td>
<td>99.72</td>
<td>448753</td>
</tr>
</tbody>
</table>
<a href="#h3-monitoring" id="h3-monitoring" class="text-decoration-none text-reset"><h3>Monitoring</h3></a>
<table class="table table-bordered">
<thead class="table-secondary">
<tr>
<th></th>
<th>cpu median(%)</th>
<th>cpu max(%)</th>
<th>memory median(MB)</th>
<th>memory max(MB)</th>
</tr>
</thead>
<tbody>
<tr>
<td>php-fpm</td>
<td>5.57</td>
<td>79.35</td>
<td>984.47</td>
<td>998.78</td>
</tr>
<tr>
<td>php-fpm-80</td>
<td>85.05</td>
<td>92.19</td>
<td>936.64</td>
<td>943.93</td>
</tr>
<tr>
<td>php-ppm</td>
<td>66.86</td>
<td>82.41</td>
<td>1,089.31</td>
<td>1,097.41</td>
</tr>
<tr>
<td>nginx-unit</td>
<td>86.14</td>
<td>93.94</td>
<td>1,067.71</td>
<td>1,069.52</td>
</tr>
<tr>
<td>road-runner</td>
<td>73.41</td>
<td>82.72</td>
<td>1,129.48</td>
<td>1,134.00</td>
</tr>
<tr>
<td>road-runner-reboot</td>
<td>80.32</td>
<td>86.29</td>
<td>982.69</td>
<td>984.80</td>
</tr>
<tr>
<td>react-php</td>
<td>73.76</td>
<td>82.18</td>
<td>1,101.71</td>
<td>1,105.06</td>
</tr>
<tr>
<td>react-php-reboot</td>
<td>85.77</td>
<td>91.92</td>
<td>975.85</td>
<td>978.42</td>
</tr>
</tbody>
</table>
<p><a href="./images/chart_4_1.png"><img src="./images/chart_4_1.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 4.1 Average Response Time per Second<br />
<a href="./images/chart_4_2.png"><img src="./images/chart_4_2.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 4.2 Average Response Time per Second (без php-fpm, php-ppm)<br />
<a href="./images/chart_4_3.png"><img src="./images/chart_4_3.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 4.3 Average CPU Load per Second<br />
<a href="./images/chart_4_4.png"><img src="./images/chart_4_4.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 4.4 Average Memory Usage per Second</p>
<a href="#h2-summary" id="h2-summary" class="text-decoration-none text-reset"><h2>Summary</h2></a>
<p>Here are the graphs showing how the performance characteristics of services change depending on the load. When viewing the graphs, keep in mind that not all services responded to 100% of the requests.</p>
<p><a href="./images/chart_5_1.png"><img src="./images/chart_5_1.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 5.1 95% response time percentile<br />
<a href="./images/chart_5_2.png"><img src="./images/chart_5_2.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 5.2 95% response time percentile (without php-fpm)<br />
<a href="./images/chart_5_3.png"><img src="./images/chart_5_3.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 5.3 Maximum CPU load<br />
<a href="./images/chart_5_4.png"><img src="./images/chart_5_4.png" alt="" class="img-fluid mx-auto d-block rounded img-max-height" /></a><br />
Chart 5.4 Maximum memory usage</p>
<p>In my opinion, the optimal solution (without changing the code) is the Nginx Unit process manager. It shows good performance in response times and has support from the company.<br />
In any case, the approach to development and the tools should be chosen individually, depending on your load, server resources, and the capabilities of your developers.</p>
</div>

<div class="footer" style="height: 40px"></div>
</body>
<link rel="stylesheet" href="/highlight.github-dark-dimmed.min.css">
<script src="/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

</html>
